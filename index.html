<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´ë©”ë¼ ë‹¨ë… í…ŒìŠ¤íŠ¸</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; }
        #reader { width: 100%; max-width: 500px; margin: 0 auto; background: #eee; border: 2px solid #333; }
        .controls { margin: 20px 0; padding: 15px; border: 1px dashed #ccc; }
        select, button { padding: 10px; font-size: 16px; margin: 5px; }
        #result { margin-top: 20px; font-weight: bold; color: blue; font-size: 20px; }
    </style>
</head>
<body>

    <h2>ğŸ“· ì¹´ë©”ë¼ ì‘ë™ í…ŒìŠ¤íŠ¸</h2>
    <p>ë‹¤ë¥¸ ê¸°ëŠ¥ ì—†ì´ ì¹´ë©”ë¼ë§Œ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

    <div id="reader"></div>

    <div class="controls">
        <select id="cam-select">
            <option value="">ì¹´ë©”ë¼ ë¡œë”© ì¤‘...</option>
        </select>
        <br>
        <button onclick="refreshCams()">1. ì¹´ë©”ë¼ ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        <button onclick="startCam()" style="background-color: #007bff; color: white;">2. ì„ íƒí•œ ì¹´ë©”ë¼ ì‹œì‘</button>
        <button onclick="stopCam()">3. ì¹´ë©”ë¼ ì¤‘ì§€</button>
    </div>

    <div id="result">QR ìŠ¤ìº” ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</div>

    <script>
        let html5QrCode;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¹´ë©”ë¼ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        window.onload = refreshCams;

        // [ê¸°ëŠ¥ 1] ì—°ê²°ëœ ì¹´ë©”ë¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        function refreshCams() {
            const select = document.getElementById('cam-select');
            Html5QrCode.getCameras().then(devices => {
                if (devices && devices.length) {
                    select.innerHTML = "";
                    devices.forEach(device => {
                        const option = document.createElement('option');
                        option.value = device.id;
                        option.text = device.label || "ì¹´ë©”ë¼ " + (select.length + 1);
                        select.appendChild(option);
                    });
                }
            }).catch(err => {
                alert("ì¹´ë©”ë¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: " + err);
            });
        }

        // [ê¸°ëŠ¥ 2] ì„ íƒí•œ ì¹´ë©”ë¼ë¡œ ìŠ¤ìº” ì‹œì‘
        function startCam() {
            const cameraId = document.getElementById('cam-select').value;
            const resultDiv = document.getElementById('result');
            if (!cameraId) return alert("ì¹´ë©”ë¼ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.");

            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    initAndStart(cameraId);
                }).catch(() => initAndStart(cameraId));
            } else {
                initAndStart(cameraId);
            }
        }

        function initAndStart(cameraId) {
            html5QrCode = new Html5QrCode("reader");
            html5QrCode.start(
                cameraId, 
                { fps: 10, qrbox: 250 },
                (decodedText) => {
                    document.getElementById('result').innerText = "âœ… ìŠ¤ìº” ì„±ê³µ: " + decodedText;
                }
            ).catch(err => {
                alert("ì¹´ë©”ë¼ ì‹œì‘ ì—ëŸ¬: " + err);
            });
        }

        // [ê¸°ëŠ¥ 3] ì¹´ë©”ë¼ ë„ê¸°
        function stopCam() {
            if (html5QrCode) {
                html5QrCode.stop().then(() => {
                    alert("ì¹´ë©”ë¼ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                });
            }
        }
    </script>
</body>
</html>
